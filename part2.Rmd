---
title: "assignment2_task2"
author: "Claire Madden"
date: "2/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

Citation: Columbia River DART, Columbia Basin Research, University of Washington. (2019). Adult Passage Graphics & Text. Available from http://www.cbr.washington.edu/dart/query/adult_graph_text

1.	A useful descriptive introductory summary (3 - 4 sentences) of whatâ€™s contained in the project
2.	Image(s), with captions and necessary citation(s), of Bonneville Dam and/or steelhead (or whatever time series data you choose to explore)
3.	All of your organized and well-annotated code (with warnings/messages hidden) used to create at least:

-	A finalized time series plot of the original observations (daily data)
-	A finalized seasonplot to explore if/how monthly passage has shifted over time (I totaled counts by month before doing this...you can choose if you want to do that)
-	A finalized visualization of annual steelhead passage counts 

4.	Make sure that your figures appear in your final knitted document, each with a useful caption. Include text associated with each to help the audience understand and interpret the results. 

```{r}

library(tidyverse)
library(tsibble)
library(fable)
library(fabletools)
library(feasts)
library(forecast)
library(janitor)
library(lubridate)

fish_data <- read_csv("cbr_fish_passage_bonneville_allyrs_steelhead.csv") %>% 
  clean_names()

# data explorations

View(fish_data)
class(fish_data$mm_dd) #character format 


```


```{r}
fish_clean <- fish_data %>% 
  mutate(date = paste(mm_dd, year)) %>% # combine date info into a single column
  mutate(ts_date = lubridate::parse_date_time(date, "dmy")) %>% # turn into a recognizable format 
  mutate(ts_date = as.Date(ts_date)) %>% # change class to date
  mutate(month_sep = yearmonth(ts_date)) %>% #not sure if i need this step but leaving it in case
  drop_na(month_sep) %>% # remove na values from month_sep (all are on February 29th which must be considered a 'nonsensical' date in tsibbles brain..?)
  drop_na(value) # drop na observations in value column


fish_parse <- fish_clean %>% 
  mutate(new_date = ts_date) %>% 
  separate(new_date, into = c("year", "month", "day"), sep = "-")
  
```



```{r}
# timeseries plot of original observations (daily data)
fish_ts_daily <- ggplot(data = fish_clean, aes(x = ts_date, y = value))+
  geom_line()+
  theme_minimal()

fish_ts_daily

```


```{r}


# seasonplot is not going great ... 

fish_ts <- as_tsibble(fish_clean, index = ts_date)
 # tsibble::fill_gaps() # not feeling sure about if i need this step or what exactly it does, check back

fish_ts %>% autoplot(value)
fish_ts %>% gg_subseries(value) # error "data contains implicit gaps in time, use tsbibble::fill_gaps() to conver to explicit missing values"

ggplot(data = fish_parse, aes(x = month , y = value, group = year)) +
  geom_line(aes(color = year), alpha = 0.5)



# make a subset with monthly totals 


```













